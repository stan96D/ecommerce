{% extends 'components/main.html' %}
{% load static tailwind_tags %}

{% block content %}
  <div class="mx-auto max-w-2xl px-4 lg:max-w-7xl lg:px-8">
    <div class="border-b pb-12 border-gray-200 pt-24 relative">
      <h1
        class="text-4xl font-bold tracking-tight text-gray-900"
        id="header-text"
      >
        Account
      </h1>
      <p class="mt-4 text-base text-gray-500">
        Hallo, {{ user.first_name }} {{ user.last_name }}!
      </p>

      <!-- Move buttons inside the header -->
      <div
        class="mb-6 flex items-center justify-end gap-x-6 absolute bottom-0 right-0"
      >
        <button
          type="submit"
          id="save-button"
          class="rounded-md bg-orange-500 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-orange-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-orange-500"
        >
          Opslaan
        </button>
      </div>
    </div>
  </div>
  <div class="mx-auto max-w-7xl  lg:flex lg:gap-x-16 lg:px-8">
    <h1 class="sr-only">Algemene instellingen</h1>
    <aside
      class="flex overflow-x-auto border-b border-gray-900/5 py-4 lg:block lg:w-64 lg:flex-none lg:border-0 lg:py-20"
    >
      <nav class="flex-none px-4 sm:px-6 lg:px-0">
        <ul
          role="list"
          class="flex gap-x-3 gap-y-1 whitespace-nowrap lg:flex-col"
        >
          <li>
            <a
              href="#"
              id="account"
              onclick="showMain('account')"
              class="aside-link group flex gap-x-3 rounded-md py-2 pl-2 pr-3 text-sm leading-6 font-semibold hover:bg-gray-50 hover:text-orange-500"
            >
              <i class="far fa-user flex-shrink-0 mt-1"></i>
              <span>Account</span>
            </a>
          </li>
          <li>
            <a
              href="#"
              id="adresgegevens"
              onclick="showMain('adresgegevens')"
              class="aside-link group flex gap-x-3 rounded-md py-2 pl-2 pr-3 text-sm leading-6 font-semibold hover:bg-gray-50 hover:text-orange-500"
            >
              <i class="far fa-address-card flex-shrink-0 mt-1"></i>
              <span>Adresgegevens</span>
            </a>
          </li>
          <li>
            <a
              href="#"
              id="orders"
              onclick="showMain('orders')"
              class="aside-link group flex gap-x-3 rounded-md py-2 pl-2 pr-3 text-sm leading-6 font-semibold hover:bg-gray-50 hover:text-orange-500"
            >
              <i class="far fa-file-alt flex-shrink-0 mt-1"></i>
              <span>Orders</span>
              <!-- Only show the badge if the count is greater than 0 -->
              {% if orders|length > 0 %}
                <span
                  class="bg-orange-500 rounded-full w-6 h-6 flex items-center justify-center text-white text-xs font-semibold ml-auto"
                >
                  {{ orders|length }}
                </span>
              {% endif %}
            </a>
          </li>
          <li>
            <a
              href="#"
              id="returns"
              onclick="showMain('returns')"
              class="aside-link group flex gap-x-3 rounded-md py-2 pl-2 pr-3 text-sm leading-6 font-semibold hover:bg-gray-50 hover:text-orange-500"
            >
              <i class="fas fa-exchange-alt flex-shrink-0 mt-1"></i>
              <span>Retouren</span>
              <!-- Only show the badge if the count is greater than 0 -->
              {% if returns|length > 0 %}
                <span
                  class="bg-orange-500 rounded-full w-6 h-6 flex items-center justify-center text-white text-xs font-semibold ml-auto"
                >
                  {{ returns|length }}
                </span>
              {% endif %}
            </a>
          </li>
        </ul>
      </nav>
    </aside>

    <section
      id="section-account"
      class="hidden px-4 py-16 sm:px-6 lg:flex-auto lg:px-0 lg:py-20"
    >
      <div class="">
        <div
          class="grid max-w-7xl grid-cols-1 gap-x-8 gap-y-10 px-4 pb-16 sm:px-6 md:grid-cols-3 lg:px-8 border-b border-gray-900/10"
        >
          <div>
            <h2 class="text-base font-semibold leading-7 text-gray-900">
              Persoonlijke informatie
            </h2>
            <p class="mt-1 text-sm leading-6 text-gray-400">
              Vul hier je persoonlijke informatie in.
            </p>
          </div>
          {% csrf_token %}

          <form id="form-account" class="md:col-span-2" method="POST">
            <div
              class="grid grid-cols-1 gap-x-6 gap-y-8 sm:max-w-xl sm:grid-cols-6"
            >
              <div class="sm:col-span-3">
                <label
                  for="first_name"
                  class="block text-sm font-medium leading-6 text-gray-900"
                  >Voornaam</label
                >
                <div class="mt-2">
                  <input
                    type="text"
                    name="first_name"
                    id="first_name"
                    autocomplete="first_name"
                    value="{{ account.first_name }}"
                    class="block w-full rounded-md border-0 bg-white/5 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-orange-500 sm:text-sm sm:leading-6"
                  />
                  <p
                    id="first_name_error"
                    class="text-red-500 text-sm mt-1"
                  ></p>
                </div>
              </div>

              <div class="sm:col-span-3">
                <label
                  for="last_name"
                  class="block text-sm font-medium leading-6 text-gray-900"
                  >Achternaam</label
                >
                <div class="mt-2">
                  <input
                    type="text"
                    name="last_name"
                    id="last_name"
                    autocomplete="last_name"
                    value="{{ account.last_name }}"
                    class="block w-full rounded-md border-0 bg-white/5 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-orange-500 sm:text-sm sm:leading-6"
                  />
                  <p id="last_name_error" class="text-red-500 text-sm mt-1"></p>
                </div>
              </div>

              <div class="col-span-full">
                <label
                  for="email"
                  class="block text-sm font-medium leading-6 text-gray-900"
                  >Email adres</label
                >
                <div class="mt-2">
                  <input
                    id="email"
                    name="email"
                    type="email"
                    autocomplete="email"
                    value="{{ account.email }}"
                    class="block w-full rounded-md border-0 bg-white/5 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-orange-500 sm:text-sm sm:leading-6"
                  />
                </div>
                <p id="email_error" class="text-red-500 text-sm mt-1"></p>
                <!-- Error message container -->
              </div>

              <div class="col-span-full">
                <label
                  for="phone"
                  class="block text-sm font-medium leading-6 text-gray-900"
                  >Telefoonnummer</label
                >
                <div class="mt-2">
                  <input
                    id="phone"
                    name="phone"
                    autocomplete="phone"
                    value="{{ account.phone_number|default_if_none:'Voer telefoonnummer in' }}"
                    class="block w-full rounded-md border-0 bg-white/5 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-orange-500 sm:text-sm sm:leading-6"
                  />
                  <p id="phone_error" class="text-red-500 text-sm mt-1"></p>
                </div>
              </div>
            </div>
          </form>
        </div>

        <div
          class="grid max-w-7xl grid-cols-1 gap-x-8 gap-y-10 px-4 py-16 sm:px-6 md:grid-cols-3 lg:px-8"
        >
          <div>
            <h2 class="text-base font-semibold leading-7 text-gray-900">
              Verwijder account
            </h2>
            <p class="mt-1 text-sm leading-6 text-gray-400">
              U kunt hier uw account verwijderen. Deze actie is niet omkeerbaar.
              Alle informatie gerelateerd aan uw account wordt permanent
              verwijderd.
            </p>
          </div>

          <div class="md:col-span-2 flex justify-end items-end">
            <form id="delete-account-form">
              <button
                type="button"
                id="delete-account-button"
                class=" bg-white  text-sm font-semibold text-red-500  hover:text-red-400"
              >
                Ja, verwijder account
              </button>
            </form>
          </div>
        </div>
      </div>
    </section>

    <section
      id="section-adresgegevens"
      class="hidden px-4 py-16 sm:px-6 lg:flex-auto lg:px-0 lg:py-20"
    >
      <div class="">
        <div
          class="grid max-w-7xl grid-cols-1 gap-x-8 gap-y-10 px-4 pb-16 sm:px-6 md:grid-cols-3 lg:px-8 border-b border-gray-900/10 "
        >
          <div>
            <h2 class="text-base font-semibold leading-7 text-gray-900">
              Persoonlijk adres
            </h2>
            <p class="mt-1 text-sm leading-6 text-gray-400">
              Vul hier je persoonlijke adresgegevens in.
            </p>
          </div>
          {% csrf_token %}

          <form id="form-delivery-address" class="md:col-span-2" method="POST">
            <div
              class="grid grid-cols-1 gap-x-6 gap-y-8 sm:max-w-xl sm:grid-cols-6 "
            >
              <div class="sm:col-span-4 sm:col-start-1">
                <label
                  for="address"
                  class="block text-sm font-medium leading-6 text-gray-900"
                  >Adres</label
                >
                <div class="mt-2">
                  <input
                    type="text"
                    name="address"
                    id="address"
                    autocomplete="address"
                    value="{{ account.address }}"
                    class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-orange-600 sm:text-sm sm:leading-6"
                  />
                  <p id="address_error" class="text-red-500 text-sm mt-1"></p>
                </div>
              </div>

              <div class="sm:col-span-2">
                <label
                  for="house_number"
                  class="block text-sm font-medium leading-6 text-gray-900"
                  >Nummer</label
                >
                <div class="mt-2">
                  <input
                    type="text"
                    name="house_number"
                    id="house_number"
                    autocomplete="house_number"
                    value="{{ account.house_number }}"
                    pattern="[0-9]*"
                    class=" block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300
                                placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-orange-600 sm:text-sm sm:leading-6"
                  />
                  <p
                    id="house_number_error"
                    class="text-red-500 text-sm mt-1"
                  ></p>
                </div>
              </div>

              <div class="sm:col-span-2 sm:col-start-1">
                <label
                  for="postal_code"
                  class="block text-sm font-medium leading-6 text-gray-900"
                  >Postcode</label
                >
                <div class="mt-2">
                  <input
                    type="text"
                    name="postal_code"
                    id="postal_code"
                    autocomplete="postal_code"
                    value="{{ account.postal_code }}"
                    class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-orange-600 sm:text-sm sm:leading-6"
                  />
                  <p
                    id="postal_code_error"
                    class="text-red-500 text-sm mt-1"
                  ></p>
                </div>
              </div>

              <div class="sm:col-span-2">
                <label
                  for="city"
                  class="block text-sm font-medium leading-6 text-gray-900"
                  >Plaats</label
                >
                <div class="mt-2">
                  <input
                    type="text"
                    name="city"
                    id="city"
                    autocomplete="city"
                    value="{{ account.city }}"
                    class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-orange-600 sm:text-sm sm:leading-6"
                  />
                  <p id="city_error" class="text-red-500 text-sm mt-1"></p>
                </div>
              </div>
              <div class="sm:col-span-3">
                <label
                  for="country"
                  class="block text-sm font-medium leading-6 text-gray-900"
                  >Land</label
                >
                <div class="mt-2">
                  <select
                    id="country"
                    name="country"
                    autocomplete="country"
                    class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-orange-600 sm:max-w-xs sm:text-sm sm:leading-6"
                  >
                    {% if account.country == "Nederland" %}
                      <option value="Nederland" selected>Nederland</option>
                    {% else %}
                      <option value="Nederland">Nederland</option>
                    {% endif %}
                    {% if account.country == "Duitsland" %}
                      <option value="Duitsland" selected>Duitsland</option>
                    {% else %}
                      <option value="Duitsland">Duitsland</option>
                    {% endif %}
                    {% if account.country == "België" %}
                      <option value="België" selected>België</option>
                    {% else %}
                      <option value="België">België</option>
                    {% endif %}
                  </select>
                  <p id="country_error" class="text-red-500 text-sm mt-1"></p>
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-4">
          <!-- Address Section -->
          <label
            class="address-label relative flex cursor-default rounded-lg border-orange-500 border bg-gradient-to-r from-orange-600  to-orange-400 p-4 shadow-sm focus:outline-none"
          >
            <span class="flex flex-1">
              <span class="flex flex-col">
                <span class="block text-sm font-medium text-white">
                  Aflever adres
                </span>
                <span class="mt-1 text-sm text-gray-50">
                  {{ account.first_name }} {{ account.last_name }}<br />
                  {{ account.address }} {{ account.house_number }}<br />
                  {{ account.postal_code }} {{ account.city }}<br />
                  {{ account.country }}
                </span>
              </span>
            </span>

            <svg
              class="h-5 w-5 text-gray-100 transition-colors duration-300"
              viewBox="0 0 20 20"
              fill="currentColor"
              aria-hidden="true"
            >
              <path
                fill-rule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z"
                clip-rule="evenodd"
              />
            </svg>

            <span
              class="pointer-events-none absolute -inset-px rounded-lg border-2 border-orange-400"
              aria-hidden="true"
            ></span>
          </label>
        </div>
      </div>
    </section>

    <section
      id="section-orders"
      class="hidden px-4 py-16 sm:px-6 lg:flex-auto lg:px-0 lg:py-20"
    >
      {% if not orders %}
        {% include 'components/messages/empty_generic_message.html' with error_message="U heeft nog geen orders." %}
      {% endif %}
      {% for order in orders %}

        {% if not forloop.first %}
          <div class="pt-24">{% include 'components/order_history.html' %}</div>
        {% else %}
          {% include 'components/order_history.html' %}
        {% endif %}
        <div></div>
      {% endfor %}
    </section>

    <section
      id="section-returns"
      class="hidden px-4 py-16 sm:px-6 lg:flex-auto lg:px-0 lg:py-20"
    >
      {% if not returns %}
        {% include 'components/messages/empty_generic_message.html' with error_message="U heeft nog geen retouren." %}
      {% endif %}

      {% for return_order in returns %}
        {% if not forloop.first %}
          <div class="pt-24">
            {% include 'components/return_order_history.html' %}
          </div>
        {% else %}
          {% include 'components/return_order_history.html' %}
        {% endif %}
        <div></div>
      {% endfor %}
    </section>
  </div>
  {% include 'components/service_section.html' %}
  <!-- HTML Structure for the Confirm Delete Modal -->
  <div
    class="relative z-10 hidden"
    id="confirmDeleteModal"
    aria-labelledby="modal-title"
    role="dialog"
    aria-modal="true"
  >
    <!-- Background backdrop -->
    <div
      class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
    ></div>

    <!-- Modal content -->
    <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
      <div
        class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"
      >
        <div
          class="relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6"
        >
          <div class="sm:flex sm:items-start">
            <div
              class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"
            >
              <svg
                class="h-6 w-6 text-red-600"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"
                />
              </svg>
            </div>
            <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
              <h3
                class="text-base font-semibold leading-6 text-gray-900"
                id="modal-title"
              >
                Account verwijderen
              </h3>
              <div class="mt-2">
                <p class="text-sm text-gray-500" id="modal-message">
                  Weet je zeker dat je je account definitief wilt verwijderen?
                  Deze actie is niet onomkeerbaar en al je gegevens zullen
                  worden verwijderd.
                </p>
              </div>
            </div>
          </div>
          <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
            <button
              onclick="confirmModalAction()"
              type="button"
              id="confirmButton"
              class="inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto"
            >
              Verwijderen
            </button>
            <button
              onclick="cancelModalAction()"
              type="button"
              id="cancelButton"
              class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto"
            >
              Annuleer
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Function to fetch address data based on postal code, house number, street, city, and country from Django backend
      async function fetchAddress(
        postalCode,
        houseNumber,
        street,
        city,
        country,
      ) {
        try {
          showSpinner() // Show the spinner before making the request

          // Create the payload (data to send in the body)
          const requestBody = {
            postal_code: postalCode,
            house_number: houseNumber,
            street: street, // Include street in the payload
            city: city, // Include city in the payload
            country: country, // Include country in the payload
          }

          // Call your Django backend to get address data
          let response = await fetch('/get-address/', {
            method: 'POST', // Use POST method
            headers: {
              'Content-Type': 'application/json', // Tell the server we're sending JSON
            },
            body: JSON.stringify(requestBody), // Send the payload as JSON in the body
          })

          // Handle the response
          let data = await response.json()
          console.log('API Response:', data)

          // Reset the visual error indications
          resetErrorIndicators()

          if (data && !data.error) {
            // Fill the form fields with the address data from the response
            document.getElementById('address').value = data.address || ''
            document.getElementById('postal_code').value =
              data.postal_code || ''
            document.getElementById('city').value = data.city || ''
            document.getElementById('country').value =
              data.country || 'Nederland' // Default country
          } else {
            // Handle error case: if data contains error or no data
            showErrorIndicators(data)
          }
        } catch (error) {
          console.error('Fout bij ophalen adres:', error)
          showErrorIndicators({
            error: 'Er is een fout opgetreden bij het ophalen van het adres.',
          })
        } finally {
          hideSpinner() // Hide the spinner after the request completes
        }
      }

      // Reset error indicators for all address fields
      function resetErrorIndicators() {
        document.getElementById('address').style.border = ''
        document.getElementById('postal_code').style.border = ''
        document.getElementById('house_number').style.border = ''
        document.getElementById('city').style.border = ''
        document.getElementById('country').style.border = ''
      }

      // Show error indicators (red borders) for relevant fields
      function showErrorIndicators(data) {
        // Check if the error is related to a specific field and apply the red border
        if (data.error) {
          // You can customize this logic further to show borders on specific fields
          if (!data.address) {
            document.getElementById('address').style.border = '1px solid red'
          }
          if (!data.postal_code) {
            document.getElementById('postal_code').style.border =
              '1px solid red'
          }
          if (!data.house_number) {
            document.getElementById('house_number').style.border =
              '1px solid red'
          }
          if (!data.city) {
            document.getElementById('city').style.border = '1px solid red'
          }
          if (!data.country) {
            document.getElementById('country').style.border = '1px solid red'
          }
        }
      }

      // Listen for street input changes (address field)
      document.getElementById('address').addEventListener('blur', function () {
        let street = this.value.trim()
        let houseNumber = document.getElementById('house_number').value.trim()
        let postalCode = document.getElementById('postal_code').value.trim()
        let city = document.getElementById('city').value.trim()
        let country = document.getElementById('country').value.trim()

        fetchAddress(postalCode, houseNumber, street, city, country)
      })

      // Listen for postal code input changes
      document
        .getElementById('postal_code')
        .addEventListener('blur', function () {
          let postalCode = this.value.trim()
          let houseNumber = document.getElementById('house_number').value.trim()
          let street = document.getElementById('address').value.trim()
          let city = document.getElementById('city').value.trim()
          let country = document.getElementById('country').value.trim()

          fetchAddress(postalCode, houseNumber, street, city, country)
        })

      // Listen for house number input changes
      document
        .getElementById('house_number')
        .addEventListener('blur', function () {
          let houseNumber = this.value.trim()
          let postalCode = document.getElementById('postal_code').value.trim()
          let street = document.getElementById('address').value.trim()
          let city = document.getElementById('city').value.trim()
          let country = document.getElementById('country').value.trim()

          fetchAddress(postalCode, houseNumber, street, city, country)
        })

      // Listen for city input changes
      document.getElementById('city').addEventListener('blur', function () {
        let city = this.value.trim()
        let houseNumber = document.getElementById('house_number').value.trim()
        let postalCode = document.getElementById('postal_code').value.trim()
        let street = document.getElementById('address').value.trim()
        let country = document.getElementById('country').value.trim()

        fetchAddress(postalCode, houseNumber, street, city, country)
      })

      // Listen for country input changes
      document.getElementById('country').addEventListener('blur', function () {
        let country = this.value.trim()
        let houseNumber = document.getElementById('house_number').value.trim()
        let postalCode = document.getElementById('postal_code').value.trim()
        let street = document.getElementById('address').value.trim()
        let city = document.getElementById('city').value.trim()

        fetchAddress(postalCode, houseNumber, street, city, country)
      })
    })
    const modal = document.getElementById('confirmDeleteModal')

    function showConfirmDeleteModal() {
      // Show the modal
      modal.classList.remove('hidden')
    }

    function confirmModalAction() {
      // Show the modal
      fetch('/delete_account/', {
        method: 'DELETE',
        headers: {
          'X-CSRFToken': getCookie('csrftoken'),
        },
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.status === 'success') {
            alert('Uw account is succesvol verwijderd.')
            window.location.href = '/' // Redirect to homepage or login page
          } else {
            alert('Er is iets misgegaan bij het verwijderen van uw account.')
          }
        })
        .catch((error) => {
          console.error('Error:', error)
          alert('Er is een fout opgetreden bij het verwijderen van uw account.')
        })
    }
    function cancelModalAction() {
      modal.classList.add('hidden')
    }

    const deleteAccountButton = document.getElementById('delete-account-button')
    deleteAccountButton.addEventListener('click', function (event) {
      event.preventDefault()

      showConfirmDeleteModal()
    })

    const saveButton = document.getElementById('save-button')
    saveButton.addEventListener('click', function () {
      saveAccount()
    })

    function saveAccount() {
      // Determine active section
      const activeSection = document.querySelector('section:not(.hidden)')
      const sectionId = activeSection ? activeSection.id : ''
      const section = sectionId.replace('section-', '')

      switch (section) {
        case 'account':
          showSpinner()
          const formAccount = document.getElementById('form-account')

          const formDataAccount = new FormData(formAccount)
          fetch('/change_account_information/', {
            method: 'POST',
            headers: {
              'X-CSRFToken': getCookie('csrftoken'),
            },
            body: formDataAccount,
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.status === 'success') {
                console.log(data)
                localStorage.setItem('success_message', data.message) // Store message before reload
                location.reload() // Reload the page
              } else {
                const errors = data.errors
                const errorElements =
                  formAccount.querySelectorAll('.error-message')

                // Display error messages for each field
                Object.keys(errors).forEach((field) => {
                  const errorMessage = errors[field]
                  const inputField = formAccount.querySelector(
                    `#${field}_error`,
                  )

                  inputField.textContent = errorMessage
                })
              }
            })
            .catch((error) => {
              console.error('Error:', error)
            })
            .finally(() => hideSpinner())

          break
        case 'adresgegevens':
          showSpinner()

          const formDeliveryAddress = document.getElementById(
            'form-delivery-address',
          )

          const formDataDeliveryAddress = new FormData(formDeliveryAddress)
          fetch('/change_delivery_address_information/', {
            method: 'POST',
            headers: {
              'X-CSRFToken': getCookie('csrftoken'),
            },
            body: formDataDeliveryAddress,
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.status === 'success') {
                location.reload()
              } else {
                const errors = data.errors
                const errorElements =
                  formDeliveryAddress.querySelectorAll('.error-message')
                errorElements.forEach((el) => el.remove())
                // Display error messages for each field
                Object.keys(errors).forEach((field) => {
                  const errorMessage = errors[field]

                  const inputField = formDeliveryAddress.querySelector(
                    `#${field}_error`,
                  )

                  inputField.textContent = errorMessage
                })
              }
            })
            .catch((error) => {
              console.error('Error:', error)
            })
            .finally(() => hideSpinner())

          break
        default:
          break
      }
    }

    function getCookie(name) {
      let cookieValue = null
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';')
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim()
          if (cookie.substring(0, name.length + 1) === name + '=') {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1))
            break
          }
        }
      }
      return cookieValue
    }
    function showMain(section) {
      // Hide all main elements
      document.querySelectorAll('section').forEach((main) => {
        if (main.id != 'motivation-section') {
          main.classList.add('hidden')
        }
      })

      // Show the selected main element
      const selectedMain = document.getElementById(`section-${section}`)
      selectedMain.classList.remove('hidden')

      // Update header text and buttons based on the selected section
      const headerText = document.getElementById('header-text')
      const saveButton = document.getElementById('save-button')

      switch (section) {
        case 'account':
          headerText.textContent = 'Account'
          saveButton.classList.remove('hidden')
          break
        case 'adresgegevens':
          headerText.textContent = 'Adresgegevens'
          saveButton.classList.remove('hidden')
          break
        case 'orders':
          headerText.textContent = 'Orders'
          saveButton.classList.add('hidden')
          break
        case 'returns':
          headerText.textContent = 'Retouren'
          saveButton.classList.add('hidden')
          break
        default:
          break
      }

      // Save the selected tab to localStorage
      localStorage.setItem('selectedTab', section)
    }

    // Call showMain function to display a specific section on initialization
    window.onload = function () {
      // Retrieve the selected tab from localStorage
      const savedTab = localStorage.getItem('selectedTab') || 'account'
      showMain(savedTab)

      // Highlight the initially selected aside item based on the saved tab
      const initialAsideLink = document.getElementById(savedTab)
      initialAsideLink.classList.add('bg-gray-50', 'text-orange-500')
    }

    // Add event listeners to handle click events and highlight the selected aside item
    document.querySelectorAll('.aside-link').forEach((link) => {
      link.addEventListener('click', function () {
        document.querySelectorAll('.aside-link').forEach((link) => {
          link.classList.remove('bg-gray-50', 'text-orange-500')
        })
        this.classList.add('bg-gray-50', 'text-orange-500')
      })
    })
  </script>
{% endblock %}
