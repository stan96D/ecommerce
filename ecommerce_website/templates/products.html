{% extends 'components/main.html' %}
{% load static tailwind_tags %}
{% load custom_filters %}

{% block title %}Home{% endblock %}

{% block content %}
  <!--
  This example requires some changes to your config:
  
  ```
  // tailwind.config.js
  module.exports = {
    // ...
    plugins: [
      // ...
      require('@tailwindcss/aspect-ratio'),
    ],
  }
  ```
-->
  <style>
    /* Class to hide the slider thumb (dot) */
    .hide-slider-dot::-webkit-slider-thumb {
      visibility: hidden; /* Hide the thumb */
    }

    .hide-slider-dot::-moz-range-thumb {
      visibility: hidden; /* Hide the thumb for Firefox */
    }

    .hide-slider-dot::-ms-thumb {
      visibility: hidden; /* Hide the thumb for Internet Explorer/Edge */
    }

    /* Base styles for the range slider */
    .range-slider {
      -webkit-appearance: none; /* Override default styles */
      appearance: none; /* Override default styles */
      background: #e5e7eb; /* gray-200 for the unselected area */
      border-radius: 9999px; /* Fully rounded */
      height: 8px; /* Height of the track */
      outline: none; /* Remove outline */
      transition: 0.3s ease; /* Smooth transition */
    }

    /* Track styling for WebKit browsers */
    .range-slider::-webkit-slider-runnable-track {
      height: 8px;
      border-radius: 9999px; /* Fully rounded */
      background: #e5e7eb; /* gray-200 */
    }

    /* Track styling for Mozilla browsers */
    .range-slider::-moz-range-track {
      height: 8px;
      border-radius: 9999px; /* Fully rounded */
      background: #e5e7eb; /* gray-200 */
    }

    /* Thumb styling for WebKit (Chrome, Safari) */
    .range-slider::-webkit-slider-thumb {
      -webkit-appearance: none; /* Remove default thumb styling */
      appearance: none; /* Remove default thumb styling */
      width: 16px; /* Thumb width */
      height: 16px; /* Thumb height */
      background-color: #f59e0b; /* amber-500 */
      border-radius: 50%; /* Make the thumb round */
      cursor: pointer; /* Pointer on hover */
      margin-top: -4px; /* Center the thumb vertically */
    }

    /* Thumb styling for Firefox */
    .range-slider::-moz-range-thumb {
      width: 16px; /* Thumb width */
      height: 16px; /* Thumb height */
      background-color: #f59e0b; /* amber-500 */
      border-radius: 50%; /* Make the thumb round */
      cursor: pointer; /* Pointer on hover */
    }

    /* Thumb styling for Edge */
    .range-slider::-ms-thumb {
      width: 16px; /* Thumb width */
      height: 16px; /* Thumb height */
      background-color: #f59e0b; /* amber-500 */
      border-radius: 50%; /* Make the thumb round */
      cursor: pointer; /* Pointer on hover */
    }

    /* Fill the track area based on the slider value */
    .range-slider:focus::-webkit-slider-runnable-track {
      background: linear-gradient(
        to right,
        #f59e0b var(--value),
        #e5e7eb var(--value)
      ); /* amber-500 for selected area */
    }

    .range-slider:focus::-moz-range-track {
      background: linear-gradient(
        to right,
        #f59e0b var(--value),
        #e5e7eb var(--value)
      ); /* amber-500 for selected area */
    }

    .range-slider:focus::-ms-track {
      background: linear-gradient(
        to right,
        #f59e0b var(--value),
        #e5e7eb var(--value)
      ); /* amber-500 for selected area */
    }
  </style>

  <div class="bg-white">
    <main class="mx-auto max-w-2xl px-4 lg:max-w-7xl lg:px-8">
      <div class="border-b border-gray-200 pt-24 relative">
        <h1 class="text-4xl font-bold tracking-tight text-gray-900">
          {{ categoryData.name }}
        </h1>
        {% if  categoryData.description %}
          <p class="mt-4 text-base text-gray-500">
            {{ categoryData.description }}
          </p>
        {% endif %}
        <div class="pb-4 pt-10 flex justify-end gap-x-2">
          <!-- Product count on the left side -->
          <div class="relative flex items-center">
            <span class="text-sm text-amber-500">
              {% if product_count == 1 %}
                {{ product_count }}
                product
              {% else %}
                {{ product_count }}
                producten
              {% endif %}
            </span>
          </div>

          <!-- Sort selection and sort button on the right side -->
          <div class="relative flex items-center gap-x-2">
            <!-- Display the selected sort type (if any) -->
            <div id="selected-sort" class="text-sm text-gray-700 hidden">
              <!-- Sort type will be dynamically inserted here -->
            </div>

            <!-- Sort button -->
            <button
              type="button"
              class="group inline-flex justify-center text-sm font-medium text-gray-700 hover:text-gray-900"
              id="menu-button"
              aria-expanded="false"
              aria-haspopup="true"
              onclick="toggleSortMenu()"
            >
              Sortering
              <svg
                class="-mr-1 ml-1 h-5 w-5 flex-shrink-0 text-gray-400 group-hover:text-gray-500"
                viewBox="0 0 20 20"
                fill="currentColor"
                aria-hidden="true"
              >
                <path
                  fill-rule="evenodd"
                  d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
                  clip-rule="evenodd"
                />
              </svg>
            </button>

            <!-- Sort menu dropdown -->
            <div
              id="sort-menu"
              class="absolute z-10 mt-2 w-40 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 divide-y divide-gray-100 hidden"
            >
              <div class="py-1">
                <button
                  class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900"
                  onclick="sortBy('price-highest')"
                >
                  Prijs aflopend
                </button>
                <button
                  class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900"
                  onclick="sortBy('price-lowest')"
                >
                  Prijs oplopend
                </button>
                <button
                  class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900"
                  onclick="sortBy('name-highest')"
                >
                  Alfabetisch A-Z
                </button>
                <button
                  class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900"
                  onclick="sortBy('name-lowest')"
                >
                  Alfabetisch Z-A
                </button>
                <button
                  class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900"
                  onclick="sortBy('geen')"
                >
                  Geen
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="pt-6">
        <button
          id="clear-filters"
          class="text-sm text-gray-400 flex items-center gap-1 hidden"
          onclick="clearFilters()"
        >
          <i class="fas fa-filter text-gray-500 pr-2"></i>
          <!-- Font Awesome filter icon -->
          Filter(s) verwijderen
        </button>
      </div>

      <div class="pb-24 pt-4 lg:grid lg:grid-cols-3 lg:gap-x-8 xl:grid-cols-4">
        <aside>
          <h2 class="sr-only">Filters</h2>
          <!-- Mobile filter dialog toggle, controls the 'mobileFilterDialogOpen' state. -->
          <button type="button" class="inline-flex items-center lg:hidden">
            <span class="text-sm font-medium text-gray-700">Filters</span>
            <svg
              class="ml-1 h-5 w-5 flex-shrink-0 text-gray-400"
              viewBox="0 0 20 20"
              fill="currentColor"
              aria-hidden="true"
            >
              <path
                d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"
              />
            </svg>
          </button>
          <div class="hidden lg:block">
            <form class="space-y-5 divide-y divide-gray-200">
              {% for product_filter in filter_data %}
                <!-- Show the first 10 filters, hide the rest inside a div with 'extra-filters' class -->
                <div
                  class="pt-5 {% if forloop.counter > 10 %}hidden extra-filters{% endif %}"
                >
                  <fieldset>
                    <div>
                      <legend
                        class="text-sm font-medium text-gray-900 flex justify-between items-center cursor-pointer"
                        onclick="toggleFilter('{{ product_filter.name }}')"
                      >
                        <span>
                          {{ product_filter.name }}
                          {% if product_filter.type == "slider" %}
                            <span
                              id="slider-value-display-{{ product_filter.name }}"
                              class="text-amber-500"
                            ></span>
                          {% endif %}
                        </span>

                        <button type="button" class="focus:outline-none">
                          <i
                            id="arrow-{{ product_filter.name }}"
                            class="fas fa-chevron-down text-gray-400 transition-transform transform"
                          ></i>
                        </button>
                      </legend>
                    </div>

                    <div
                      id="{{ product_filter.name }}"
                      class="filter-container space-y-3 pt-6 hidden"
                      type="{{ product_filter.type }}"
                    >
                      {% if product_filter.type == "option" %}
                        {% for product_attribute in product_filter.values %}
                          {% if forloop.counter <= 5 %}
                            <div class="flex items-center">
                              <input
                                id="attr-{{ product_attribute }}"
                                name="{{ product_filter.name }}"
                                value="{{ product_attribute }}"
                                type="checkbox"
                                class="filter-checkbox h-4 w-4 rounded border-gray-300 text-amber-500 focus:ring-customColor"
                                onclick="executeSearch(this)"
                              />
                              <label
                                for="attr-{{ product_attribute }}"
                                class="ml-3 text-sm text-gray-600"
                                >{{ product_attribute }}</label
                              >
                            </div>
                          {% else %}
                            <div
                              class="flex items-center hidden extra-{{ product_filter.name }}"
                            >
                              <input
                                id="attr-{{ product_attribute }}"
                                name="{{ product_filter.name }}"
                                value="{{ product_attribute }}"
                                type="checkbox"
                                class="filter-checkbox h-4 w-4 rounded border-gray-300 text-amber-500 focus:ring-customColor"
                                onclick="executeSearch(this)"
                              />
                              <label
                                for="attr-{{ product_attribute }}"
                                class="ml-3 text-sm text-gray-600"
                                >{{ product_attribute }}</label
                              >
                            </div>
                          {% endif %}
                        {% endfor %}

                        {% if product_filter.values|length > 5 %}
                          <div>
                            <button
                              type="button"
                              class="text-sm text-amber-500 underline"
                              onclick="toggleExtraFilters('{{ product_filter.name }}', this)"
                            >
                              Meer tonen
                            </button>
                          </div>
                        {% endif %}
                      {% elif product_filter.type == "slider" %}
                        <div>
                          <div class="flex items-center justify-between w-full">
                            <div
                              id="min-value-{{ product_filter.name }}"
                              class="flex-1 text-sm text-black-600 border border-gray-300 rounded-l-lg p-2 text-center mr-2"
                            >
                              {{ product_filter.lowest }}
                              <!-- Display the lowest value -->
                            </div>
                            <div
                              id="max-value-{{ product_filter.name }}"
                              class="flex-1 text-sm text-black-600 border border-gray-300 rounded-r-lg p-2 text-center"
                            >
                              {{ product_filter.highest }}
                              <!-- Display the highest value -->
                            </div>
                          </div>
                          <input
                            type="range"
                            min="{{ product_filter.lowest|floor }}"
                            max="{{ product_filter.highest|ceil }}"
                            step="{{ product_filter.lowest|calculate_step:product_filter.highest }}"
                            value="{{ product_filter.highest|ceil }}"
                            data-filter-name="{{ product_filter.name }}"
                            data-default-value="{{ product_filter.highest|ceil }}"
                            data-unit="{{ product_filter.unit }}"
                            class="w-full h-2 bg-amber-500 rounded-lg appearance-none cursor-pointer range-slider"
                            oninput="updateSliderValue(this.value, '{{ product_filter.name }}')"
                          />
                          <div class="flex items-center justify-between mt-2">
                            <div
                              id="slider-value-{{ product_filter.name }}"
                              class="text-sm text-gray-600 flex-1"
                            >
                              {% if product_filter.unit == '€' %}
                                {{ product_filter.unit }}
                                {{ product_filter.highest|ceil }}
                              {% else %}
                                {{ product_filter.highest|ceil }}
                                {{ product_filter.unit }}
                              {% endif %}
                            </div>
                            <button
                              type="button"
                              class="text-sm text-amber-500 underline"
                              onclick="executeSearchSlider('{{ product_filter.name }}')"
                            >
                              Filter toevoegen
                            </button>
                          </div>
                        </div>
                      {% endif %}
                    </div>
                  </fieldset>
                </div>
              {% endfor %}

              <!-- Show More button to reveal extra filters if there are more than 10 filters -->
              {% if filter_data|length > 10 %}
                <div class="pt-5">
                  <button
                    type="button"
                    class="text-sm text-amber-500 underline"
                    onclick="toggleAllFilters()"
                  >
                    Meer filters
                  </button>
                </div>
              {% endif %}
            </form>
          </div>
        </aside>

        <section
          aria-labelledby="product-heading"
          class="mt-6 lg:col-span-2 lg:mt-0 xl:col-span-3"
        >
          <h2 id="product-heading" class="sr-only">Products</h2>

          <div class="mx-auto max-w-2xl px-4 sm:px-6 lg:max-w-7xl lg:px-8">
            <h2 class="sr-only">Products</h2>

            <div
              class="grid grid-cols-1 gap-x-6 gap-y-10 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 xl:gap-x-8"
            >
              {% if products|length > 0 %}
                {% for product in products %}
                  {% include 'components/product_card.html' with product=product %}
                {% endfor %}
              {% else %}
                <div class="col-span-full text-center text-xl text-gray-500">
                  {% if categoryData.name == "Favorieten" %}
                    {% include 'components/messages/empty_generic_message.html' with error_message="We hebben helaas geen favorieten voor u kunnen vinden. Probeer het alsjeblieft opnieuw met andere filters of selecteer nieuwe producten als favorieten." %}
                  {% else %}
                    {% include 'components/messages/empty_generic_message.html' with error_message="We hebben helaas geen producten voor u kunnen vinden. Probeer het alsjeblieft opnieuw met andere filters." %}
                  {% endif %}
                </div>
              {% endif %}
            </div>
          </div>
          <nav
            aria-label="Pagination"
            class="mx-auto mt-12 px-8 flex max-w-7xl justify-between text-sm font-medium text-gray-700"
          >
            {% if page_obj.has_previous or page_obj.has_next %}
              <!-- Previous Button -->
              <div class="min-w-0 flex-1">
                {% if page_obj.has_previous %}
                  <a
                    href="javascript:void(0)"
                    onclick="goToPage({{ page_obj.previous_page_number }})"
                    class="inline-flex h-10 items-center rounded-md border border-gray-300 bg-white px-4 hover:bg-gray-100 focus:border-amber-500 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-opacity-25 focus:ring-offset-1 focus:ring-offset-amber-500"
                    >Vorige</a
                  >
                {% endif %}
              </div>

              <!-- Page Numbers -->
              <div class="hidden space-x-2 sm:flex">
                {% with page_obj.paginator as paginator %}
                  {% with paginator.page_range as page_range %}
                    <!-- Show First Page -->
                    {% if page_obj.number > 4 %}
                      <a
                        href="javascript:void(0)"
                        onclick="goToPage(1)"
                        class="inline-flex h-10 w-10 items-center justify-center rounded-full border border-gray-300 bg-white hover:bg-gray-100 focus:border-amber-500 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-opacity-25 focus:ring-offset-1 focus:ring-offset-amber-500"
                        >1</a
                      >

                      {% if page_obj.number > 5 %}
                        <span
                          class="inline-flex h-10 items-center px-1.5 text-gray-500"
                          >...</span
                        >
                      {% endif %}
                    {% endif %}

                    <!-- Pages Around Current Page -->
                    {% for i in page_range %}
                      {% if i >= page_obj.number|add:'-3' and i <= page_obj.number|add:'3' %}
                        {% if i == page_obj.number %}
                          <span
                            class="inline-flex h-10 w-10 items-center justify-center rounded-full border border-amber-500 bg-white ring-1 ring-amber-500"
                            >{{ i }}</span
                          >
                        {% else %}
                          <a
                            href="javascript:void(0)"
                            onclick="goToPage({{ i }})"
                            class="inline-flex h-10 w-10 items-center justify-center rounded-full border border-gray-300 bg-white hover:bg-gray-100 focus:border-amber-500 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-opacity-25 focus:ring-offset-1 focus:ring-offset-amber-500"
                            >{{ i }}</a
                          >
                        {% endif %}
                      {% endif %}
                    {% endfor %}

                    <!-- Show Ellipsis and Last Page -->
                    {% if page_obj.number < paginator.num_pages|add:'-3' %}
                      {% if page_obj.number < paginator.num_pages|add:'-4' %}
                        <span
                          class="inline-flex h-10 items-center px-1.5 text-gray-500"
                          >...</span
                        >
                      {% endif %}
                      {% if paginator.num_pages != page_obj.number %}
                        <a
                          href="javascript:void(0)"
                          onclick="goToPage({{ paginator.num_pages }})"
                          class="inline-flex h-10 w-10 items-center justify-center rounded-full border border-gray-300 bg-white hover:bg-gray-100 focus:border-amber-500 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-opacity-25 focus:ring-offset-1 focus:ring-offset-amber-500"
                          >{{ paginator.num_pages }}</a
                        >
                      {% endif %}
                    {% endif %}
                  {% endwith %}
                {% endwith %}
              </div>

              <!-- Next Button -->
              <div class="flex min-w-0 flex-1 justify-end">
                {% if page_obj.has_next %}
                  <a
                    href="javascript:void(0)"
                    onclick="goToPage({{ page_obj.next_page_number }})"
                    class="inline-flex h-10 items-center rounded-md border border-gray-300 bg-white px-4 hover:bg-gray-100 focus:border-amber-500 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-opacity-25 focus:ring-offset-1 focus:ring-offset-amber-500"
                    >Volgende</a
                  >
                {% endif %}
              </div>
            {% endif %}
          </nav>
        </section>
      </div>
    </main>
  </div>

  <script>
    // Function to uncheck all checkboxes
    function uncheckAllCheckboxes() {
      // Select all checkboxes with the class 'filter-checkbox'
      const checkboxes = document.querySelectorAll('.filter-checkbox')

      // Iterate over each checkbox and uncheck it
      checkboxes.forEach((checkbox) => {
        checkbox.checked = false
      })
    }

    function fillValuesForQuery(query) {
      const filterDivs = document.querySelectorAll('.filter-container')
      filterDivs.forEach((filterDiv) => {
        const filterName = filterDiv.id
        const arrowIcon = document.getElementById(`arrow-${filterName}`)
        const sliderDisplay = document.getElementById(
          `slider-value-display-${filterName}`,
        )
        // Check if the filter section should be open based on query parameters
        const isOpen = query.has(filterName) // Check if the filterName exists in the query

        if (isOpen) {
          filterDiv.classList.remove('hidden')
          arrowIcon.classList.remove('fa-chevron-down')
          arrowIcon.classList.add('fa-chevron-up')

          if (sliderDisplay) {
            // Check if the filter name exists in the URL's query parameters
            const savedValue = query.get(filterName) // Directly use the filterName as query param key

            if (savedValue !== null) {
              // If a saved value exists in the query string, update the displayed value
              sliderDisplay.innerHTML = savedValue // You can apply any formatting as needed
            } else {
              // If no value is found in the query string, we don't display anything (the span remains empty)
              sliderDisplay.innerHTML = '' // This line is optional since the span is already empty by default
            }
          }
        } else {
          filterDiv.classList.add('hidden')
          arrowIcon.classList.remove('fa-chevron-up')
          arrowIcon.classList.add('fa-chevron-down')
        }

        if (sliderDisplay) {
        }

        const filterValues = query.getAll(filterName)
        const checkboxes = document.querySelectorAll(
          `.filter-checkbox[name="${filterName}"]`,
        )
        checkboxes.forEach((checkbox) => {
          checkbox.checked = false
        })

        // Now, check the boxes that match the query parameters
        if (!filterDiv.classList.contains('hidden') && !sliderDisplay) {
          filterValues.forEach((filterValueString) => {
            const filterValues = filterValueString
              .split(',') // Split values by comma if multiple values are selected
              .map((value) => value.trim()) // Clean up extra spaces
            filterValues.forEach((filterValue) => {
              // Find the checkbox corresponding to the current filter name and value
              const checkbox = document.querySelector(
                `.filter-checkbox[name="${filterName}"][value="${filterValue}"]`,
              )
              if (checkbox) {
                checkbox.checked = true // Reset all checkboxes
              }
            })
          })
        }
      })
    }

    window.addEventListener('DOMContentLoaded', () => {
      initializeSortTypeDisplay()

      // Add click listener to document
      document.addEventListener('click', (event) => {
        const sortMenu = document.getElementById('sort-menu')
        const menuButton = document.getElementById('menu-button')

        // Check if the clicked element is not inside the sort menu or the menu button
        if (
          !sortMenu.contains(event.target) &&
          !menuButton.contains(event.target)
        ) {
          sortMenu.classList.add('hidden')
        }
      })
    })

    function executeSearchSlider(sliderName) {
      console.log('Slider Name:', sliderName)

      // Get the slider element using the sliderName (which is the data-filter-name attribute)
      const sliderElement = document.querySelector(
        `input[data-filter-name="${sliderName}"]`,
      )

      // Ensure the slider element exists
      if (sliderElement) {
        // Get the value of the slider
        const value = sliderElement.value
        console.log('Slider Value:', value)

        // Get the current URL and its query parameters
        const currentUrl = new URL(window.location.href)
        const queryParams = new URLSearchParams(currentUrl.search)

        // Update or add the slider value to the query parameters
        queryParams.set(sliderName, value) // Update or add the parameter

        // Set the updated query string to the current URL
        currentUrl.search = queryParams.toString()
        window.location.href = currentUrl.href
      } else {
        console.error('Slider not found for:', sliderName)
      }
    }

    function executeSearch(checkbox) {
      console.log('Checkbox Name:', checkbox.name)

      // Get the value of the checkbox
      const value = checkbox.value
      const filterName = checkbox.name
      console.log('Checkbox Value:', value)

      // Get the current URL and its query parameters
      const currentUrl = new URL(window.location.href)
      const queryParams = new URLSearchParams(currentUrl.search)

      if (checkbox.checked) {
        // If checkbox is checked, add its value to the query string
        if (!queryParams.has(filterName)) {
          queryParams.append(filterName, value) // Use append to allow multiple values for the same filter name
        } else {
          queryParams.set(filterName, value) // Update the value if it exists
        }
      } else {
        // If checkbox is unchecked, remove its value from the query string
        const currentValues = queryParams.getAll(filterName)
        const newValues = currentValues.filter((val) => val !== value)
        queryParams.delete(filterName) // Remove the filter name

        // Re-add remaining values for that filter (if any) after removing the unchecked value
        newValues.forEach((val) => queryParams.append(filterName, val))
      }

      // Set the updated query string to the current URL
      currentUrl.search = queryParams.toString()

      window.location.href = currentUrl.href

      console.log('Updated URL:', currentUrl.toString())
    }

    function toggleFilter(filterName) {
      const filterDiv = document.getElementById(filterName)
      const arrowIcon = document.getElementById(`arrow-${filterName}`)
      const isOpen = filterDiv.classList.toggle('hidden')

      const filterStates = getFilterStates()
      filterStates[filterName] = !isOpen

      if (!isOpen) {
        arrowIcon.classList.remove('fa-chevron-down')
        arrowIcon.classList.add('fa-chevron-up')
      } else {
        arrowIcon.classList.remove('fa-chevron-up')
        arrowIcon.classList.add('fa-chevron-down')
      }
    }

    function getFilterStates() {
      const filterStates = {}
      const filterDivs = document.querySelectorAll('.filter-container')
      filterDivs.forEach((filterDiv) => {
        const filterName = filterDiv.id
        const isOpen = !filterDiv.classList.contains('hidden')
        filterStates[filterName] = isOpen
      })
      console.log(filterStates)
      return filterStates
    }

    function toggleSortMenu() {
      const sortMenu = document.getElementById('sort-menu')
      sortMenu.classList.toggle('hidden')
    }

    function goToPage(pageNumber) {
      // Get the current URL's query string
      const existingQueryString = window.location.search

      // Create the new query string with the page parameter
      let queryString = `page=${pageNumber}`

      // Check if there are existing query parameters
      if (existingQueryString) {
        // If there are existing query parameters, add the new page parameter
        // Ensure that 'page' parameter doesn't already exist in the URL
        const pageParamIndex = existingQueryString.indexOf('page=')
        if (pageParamIndex !== -1) {
          // If 'page' parameter exists, replace it
          const ampersandIndex = existingQueryString.indexOf(
            '&',
            pageParamIndex,
          )
          if (ampersandIndex !== -1) {
            queryString =
              existingQueryString.substring(0, pageParamIndex) +
              queryString +
              existingQueryString.substring(ampersandIndex)
          } else {
            queryString =
              existingQueryString.substring(0, pageParamIndex) + queryString
          }
        } else {
          // If 'page' parameter does not exist, append it
          queryString =
            existingQueryString +
            (existingQueryString ? '&' : '?') +
            queryString
        }
      } else {
        // If there are no existing query parameters, just set the query string
        queryString = '?' + queryString
      }

      // Construct the new URL
      const newUrl = window.location.pathname + queryString

      // Redirect to the new URL
      window.location.href = newUrl
    }

    function sortBy(sortType) {
      const selectedSort = document.getElementById('selected-sort')
      const sortMenu = document.getElementById('sort-menu')
      const menuButton = document.getElementById('menu-button')

      let queryString = ''
      switch (sortType) {
        case 'price-highest':
          queryString = 'tn_sort=Prijs%20aflopend'
          break
        case 'price-lowest':
          queryString = 'tn_sort=Prijs%20oplopend'
          break
        case 'name-highest':
          queryString = 'tn_sort=Alfabetisch%20A-Z'
          break
        case 'name-lowest':
          queryString = 'tn_sort=Alfabetisch%20Z-A'
          break
        case 'geen':
          queryString = ''
          break
        default:
          break
      }

      const existingQueryString = window.location.search

      if (!queryString) {
        // Remove 'tn_sort' parameter if 'Geen' is selected
        const sortingParamIndex = existingQueryString.indexOf('tn_sort=')
        if (sortingParamIndex !== -1) {
          const ampersandIndex = existingQueryString.indexOf(
            '&',
            sortingParamIndex,
          )
          if (ampersandIndex !== -1) {
            queryString =
              existingQueryString.substring(0, sortingParamIndex) +
              existingQueryString.substring(ampersandIndex)
          } else {
            queryString = existingQueryString.substring(0, sortingParamIndex)
          }
        }
      } else {
        // Append or replace 'tn_sort' parameter
        const sortingParamIndex = existingQueryString.indexOf('tn_sort=')
        if (sortingParamIndex !== -1) {
          const ampersandIndex = existingQueryString.indexOf(
            '&',
            sortingParamIndex,
          )
          if (ampersandIndex !== -1) {
            queryString =
              existingQueryString.substring(0, sortingParamIndex) +
              queryString +
              existingQueryString.substring(ampersandIndex)
          } else {
            queryString =
              existingQueryString.substring(0, sortingParamIndex) + queryString
          }
        } else {
          queryString =
            existingQueryString === ''
              ? '?' + queryString
              : existingQueryString + '&' + queryString
        }
      }

      const newUrl = window.location.pathname + queryString

      window.location.href = newUrl
    }

    function getActiveSortType() {
      const sortTypes = [
        'Prijs oplopend',
        'Prijs aflopend',
        'Alfabetisch A-Z',
        'Alfabetisch Z-A',
      ]
      for (const sortType of sortTypes) {
        if (isSortTypeActive(sortType)) {
          return sortType
        }
      }
      // Return default value if no other sort type is active
      return 'Geen'
    }

    function isSortTypeActive(sortType) {
      const currentUrl = window.location.href
      const searchString = encodeURIComponent(sortType)
      const isActive = currentUrl.includes(searchString)

      console.log(isActive, currentUrl, searchString)
      return isActive
    }

    function initializeSortTypeDisplay() {
      const sortTypes = [
        'Prijs oplopend',
        'Prijs aflopend',
        'Alfabetisch A-Z',
        'Alfabetisch Z-A',
      ]
      let isActive = false
      sortTypes.forEach((sortType) => {
        if (isSortTypeActive(sortType)) {
          isActive = true
          document.getElementById('selected-sort').textContent = `${sortType}`
        }
      })

      const sortTypeSpan = document.getElementById('selected-sort')
      if (!isActive) {
        sortTypeSpan.classList.add('hidden')
      } else {
        sortTypeSpan.classList.remove('hidden')
      }
    }

    function toggleExtraFilters(filterName, button) {
      const extraFilters = document.querySelectorAll('.extra-' + filterName)
      extraFilters.forEach((filter) => {
        filter.classList.toggle('hidden')
      })

      // Change button text based on visibility
      if (extraFilters[0].classList.contains('hidden')) {
        button.innerText = 'Meer tonen' // Show More
      } else {
        button.innerText = 'Minder tonen' // Show Less
      }
    }
    function toggleAllFilters() {
      const extraFilters = document.querySelectorAll('.extra-filters')
      extraFilters.forEach((filter) => filter.classList.toggle('hidden'))

      // Toggle button text between "Show More" and "Show Less"
      const button = event.target
      button.textContent = button.textContent.includes('Meer filters')
        ? 'Minder filters'
        : 'Meer filters'
    }

    function clearFilters() {
      // Create a new URL object based on the current URL
      const url = new URL(window.location.href)

      // Create a new URLSearchParams object to hold the new parameters
      const newUrlParams = new URLSearchParams()

      // Get all the current search parameters
      const urlParams = new URLSearchParams(url.search)

      // Add 'q' and 'tn_sort' to the new URLSearchParams object
      if (urlParams.has('q')) {
        newUrlParams.set('q', urlParams.get('q'))
      }
      if (urlParams.has('tn_sort')) {
        newUrlParams.set('tn_sort', urlParams.get('tn_sort'))
      }

      // Update the URL with the new parameters
      url.search = newUrlParams.toString()

      // Refresh the page with the updated URL (this will remove all other filters)
      window.location.href = url.href // Redirect to the new URL
    }

    function updateSliderValue(value, sliderName) {
      // Update the display for the correct slider
      const sliderElement = document.getElementById(
        `slider-value-${sliderName}`,
      )
      const slider = document.querySelector(
        `input[data-filter-name="${sliderName}"]`,
      ) // Get the corresponding slider input
      const unit = slider.getAttribute('data-unit') // Get the unit from the data attribute, assuming you add this to your HTML

      // Format the displayed value based on the unit
      if (unit === '€') {
        sliderElement.textContent = `${unit} ${value}` // Display euro sign before the value
      } else {
        sliderElement.textContent = `${value} ${unit}` // Display unit after the value
      }
    }

    function removeSliderFilter(filterName) {
      console.log('Removing Filter for:', filterName)

      // Get the current URL and its query parameters
      const currentUrl = new URL(window.location.href)
      const queryParams = new URLSearchParams(currentUrl.search)

      // Remove the filter from the query parameters
      queryParams.delete(filterName) // This removes the filter with the given name

      // Update the URL with the modified query parameters
      currentUrl.search = queryParams.toString()

      // Reload the page with the updated URL
      window.location.href = currentUrl.href
    }

    function setNotSlidableFilters() {
      document
        .querySelectorAll('.flex.items-center.justify-between.w-full')
        .forEach(function (sliderContainer) {
          const minElement = sliderContainer.querySelector('[id^="min-value-"]')
          const maxElement = sliderContainer.querySelector('[id^="max-value-"]')
          const filterName = minElement
            ? minElement.id.replace('min-value-', '')
            : null

          // Find corresponding slider and buttons
          const sliderInput = document.querySelector(
            `input[data-filter-name="${filterName}"]`,
          )
          const filterButton = document.querySelector(
            `button[onclick*="${filterName}"]`,
          )

          const sliderValueView = document.getElementById(
            `slider-value-${filterName}`,
          )

          if (minElement && maxElement) {
            const minValue = parseFloat(minElement.textContent.trim())
            const maxValue = parseFloat(maxElement.textContent.trim())

            if (minValue === maxValue) {
              // Hide only the slider dot
              if (sliderInput) {
                sliderInput.style.pointerEvents = 'none' // Disable interaction
                sliderInput.style.background = 'rgba(255, 193, 7, 0.5)' // Make the slider visually indicate it's inactive
                sliderInput.classList.add('hide-slider-dot') // Add class to hide the slider thumb
              }
              // Replace "Filter toevoegen" with "Remove filter"
              if (filterButton) {
                // Check if filter is applied based on the URL
                const urlParams = new URLSearchParams(window.location.search)
                const filterValueFromUrl = urlParams.get(filterName)
                console.log(filterValueFromUrl, filterName)

                if (filterValueFromUrl) {
                  filterButton.textContent = 'Filter verwijderen'
                  filterButton.setAttribute(
                    'onclick',
                    `removeSliderFilter('${filterName}')`,
                  )
                } else {
                  filterButton.style.display = 'none' // Hide button if filter is not applied
                }
              }
              if (sliderValueView) {
                sliderValueView.innerHTML = '' // Clear all the content inside the element
              }
            }
          }
        })
    }

    // Function to check for filters in the URL and log their values
    function checkUrlForFilters() {
      const urlParams = new URLSearchParams(window.location.search)
      const filters = {}

      // Iterate over all URL parameters
      for (const [key, value] of urlParams.entries()) {
        // Check if the key is 'q' (search query) and handle it separately
        if (key !== 'tn_sort' && key !== 'q' && key !== 'page') {
          // Exclude any sorting parameters (like 'tn_sort') or other irrelevant ones
          filters[key] = decodeURIComponent(value) // Decode the value and add it to the filters object
        }
        console.log(key, value) // Log the key and value for debugging
      }

      // Log the filters to the console
      if (Object.keys(filters).length > 0) {
        document.getElementById('clear-filters').style.display = 'inline-flex'
      } else {
        document.getElementById('clear-filters').style.display = 'none'
      }
      // Reset all sliders
      const sliders = document.querySelectorAll('input[type="range"]')
      sliders.forEach((slider) => {
        const defaultValue = slider.getAttribute('data-default-value') // Get the value of the data-default-value attribute
        console.log(defaultValue)
        slider.value = defaultValue // Reset the slider to the minimum value (or set to your default)
      })
      console.log(filters)
      setNotSlidableFilters()

      fillValuesForQuery(urlParams)
    }

    // Call the function to log the filters and update button visibility when the page loads
    window.addEventListener('load', checkUrlForFilters)
  </script>
{% endblock %}
